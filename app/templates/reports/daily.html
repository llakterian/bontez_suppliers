{% extends "base.html" %}

{% block title %}Daily Report - Bontez Suppliers{% endblock %}

{% block extra_css %}
<style>
    .report-header {
        background: white;
        padding: 24px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        margin-bottom: 30px;
    }
    .report-header form {
        display: flex;
        gap: 12px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    .report-header input,
    .report-header button {
        margin-bottom: 0;
    }
    .charts-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 24px;
        margin-bottom: 30px;
    }
    .chart-wrapper {
        background-color: white;
        border: 2px solid var(--border);
        padding: 24px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        transition: var(--transition);
    }
    .chart-wrapper:hover {
        border-color: var(--primary);
        box-shadow: var(--shadow-lg);
    }
    .chart-title {
        font-weight: 600;
        margin-bottom: 20px;
        text-align: center;
        color: var(--dark);
        font-size: 16px;
    }
    canvas {
        max-width: 100%;
    }
</style>
{% endblock %}

{% block content %}
<h2>Daily Sales Report</h2>

<div class="report-header">
    <form method="GET">
        <input type="date" name="date" value="{{ report_date.strftime('%Y-%m-%d') }}" required>
        <button type="submit" class="btn btn-primary">Load Report</button>
        <span style="color: #6c757d; font-weight: 500;">
            Report for: <strong>{{ report_date.strftime('%B %d, %Y') }}</strong>
        </span>
    </form>
</div>

<div class="charts-container">
    <div class="chart-wrapper">
        <div class="chart-title">Sales by Supplier (Bar Chart)</div>
        <canvas id="barChart"></canvas>
    </div>
    <div class="chart-wrapper">
        <div class="chart-title">Sales Distribution (Pie Chart)</div>
        <canvas id="pieChart"></canvas>
    </div>
</div>

<div class="summary-section">
    <h3>Daily Summary</h3>
    <div id="summaryContent">
        <p style="color: #6c757d;">Loading summary...</p>
    </div>
</div>

<div class="actions">
    <a href="{{ url_for('reports.monthly_report') }}" class="btn btn-primary">View Monthly Report</a>
    <a href="{{ url_for('main.index') }}" class="btn btn-secondary">Back to Dashboard</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const reportDate = '{{ report_date.strftime('%Y-%m-%d') }}';
    
    fetch('/reports/daily-data?date=' + reportDate)
        .then(response => response.json())
        .then(data => {
            const colors = data.colors;
            const labels = data.labels;
            const salesData = data.data;
            
            const barCtx = document.getElementById('barChart').getContext('2d');
            new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales Amount (KES)',
                        data: salesData,
                        backgroundColor: colors,
                        borderColor: colors,
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (KES)'
                            }
                        }
                    }
                }
            });
            
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: salesData,
                        backgroundColor: colors,
                        borderColor: 'white',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            const total = salesData.reduce((a, b) => a + b, 0);
            const summaryHtml = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">' +
                               '<div><p style="color: #6c757d; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Total Daily Sales</p><p style="font-size: 24px; font-weight: 700; margin-bottom: 0; color: var(--primary);">KES ' + total.toFixed(2) + '</p></div>' +
                               '<div><p style="color: #6c757d; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Number of Suppliers</p><p style="font-size: 24px; font-weight: 700; margin-bottom: 0; color: var(--primary);">' + labels.length + '</p></div>' +
                               '</div>';
            document.getElementById('summaryContent').innerHTML = summaryHtml;
        });
});
</script>
{% endblock %}
