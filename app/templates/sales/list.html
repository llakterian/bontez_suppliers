{% extends "base.html" %}

{% block title %}Sales - Bontez Suppliers{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h2>Sales Transactions</h2>
    <a href="{{ url_for('sales.create_sale') }}" class="btn btn-primary">Create New Sale</a>
</div>

{% if sales.items %}
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Client</th>
                    <th>Supplier</th>
                    <th>Total Amount</th>
                    <th>Paid</th>
                    <th>Balance</th>
                    <th>Payment Method</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for sale in sales.items %}
                <tr>
                    <td>{{ sale.sale_date.strftime('%b %d, %Y') }}</td>
                    <td><strong>{{ sale.client.name }}</strong></td>
                    <td>{{ sale.supplier.name if sale.supplier else 'Mixed Gas' }}</td>
                    <td><strong>KES {{ "{:,.2f}".format(sale.total_amount) }}</strong></td>
                    <td>KES {{ "{:,.2f}".format(sale.amount_paid) }}</td>
                    <td>
                        {% if sale.remaining_balance() == 0 %}
                            <span style="color: var(--success);">KES 0</span>
                        {% else %}
                            <span style="color: var(--warning);">KES {{ "{:,.2f}".format(sale.remaining_balance()) }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <span style="padding: 4px 8px; background: var(--primary-light); color: var(--primary); border-radius: 4px; font-size: 12px; font-weight: 600;">
                            {{ sale.payment_method.upper() }}
                        </span>
                    </td>
                    <td><a href="{{ url_for('sales.view_sale', sale_id=sale.id) }}">View</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if sales.pages > 1 %}
    <div class="pagination">
        {% if sales.has_prev %}
            <a href="{{ url_for('sales.list_sales', page=sales.prev_num) }}">Previous</a>
        {% endif %}

        <span style="padding: 10px 14px; color: #6c757d; font-weight: 500;">
            Page {{ sales.page }} of {{ sales.pages }}
        </span>

        {% if sales.has_next %}
            <a href="{{ url_for('sales.list_sales', page=sales.next_num) }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 12px;">
        <p style="color: #6c757d; margin-bottom: 20px;">No sales recorded yet.</p>
        <a href="{{ url_for('sales.create_sale') }}" class="btn btn-primary">Create First Sale</a>
    </div>
{% endif %}
{% endblock %}
