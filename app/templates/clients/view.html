{% extends "base.html" %}

{% block title %}{{ client.name }} - Bontez Suppliers{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h2>{{ client.name }}</h2>
    <a href="{{ url_for('clients.list_clients') }}" class="btn btn-secondary">Back to Clients</a>
</div>

<div class="client-details">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
        <div>
            <p style="color: #6c757d; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Phone</p>
            <p style="margin-bottom: 0;"><strong>{{ client.phone }}</strong></p>
        </div>
        <div>
            <p style="color: #6c757d; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Email</p>
            <p style="margin-bottom: 0;"><strong>{{ client.email or 'Not provided' }}</strong></p>
        </div>
        <div>
            <p style="color: #6c757d; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Member Since</p>
            <p style="margin-bottom: 0;"><strong>{{ client.created_at.strftime('%B %d, %Y') }}</strong></p>
        </div>
    </div>
    {% if client.address %}
    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
        <p style="color: #6c757d; font-size: 12px; text-transform: uppercase; margin-bottom: 4px;">Address</p>
        <p style="margin-bottom: 0;"><strong>{{ client.address }}</strong></p>
    </div>
    {% endif %}
</div>

<h3 style="margin-top: 40px;">Sales History</h3>
{% if sales %}
    <div style="overflow-x: auto;">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Supplier</th>
                    <th>Amount</th>
                    <th>Payment Method</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for sale in sales %}
                <tr>
                    <td>{{ sale.sale_date.strftime('%b %d, %Y %H:%M') }}</td>
                    <td>{{ sale.supplier.name if sale.supplier else 'Mixed Gas' }}</td>
                    <td><strong>KES {{ "{:,.2f}".format(sale.total_amount) }}</strong></td>
                    <td>
                        <span style="padding: 4px 8px; background: var(--primary-light); color: var(--primary); border-radius: 4px; font-size: 12px; font-weight: 600;">
                            {{ sale.payment_method.upper() }}
                        </span>
                    </td>
                    <td>
                        {% if sale.remaining_balance() == 0 %}
                            <span style="padding: 4px 8px; background: #d4edda; color: #155724; border-radius: 4px; font-size: 12px; font-weight: 600;">Paid</span>
                        {% else %}
                            <span style="padding: 4px 8px; background: #fff3cd; color: #856404; border-radius: 4px; font-size: 12px; font-weight: 600;">Outstanding: KES {{ "{:,.2f}".format(sale.remaining_balance()) }}</span>
                        {% endif %}
                    </td>
                    <td><a href="{{ url_for('sales.view_sale', sale_id=sale.id) }}">View</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <div style="text-align: center; padding: 40px; background: white; border-radius: 12px; color: #6c757d;">
        <p>No sales for this client yet.</p>
    </div>
{% endif %}

<div class="actions">
    <a href="{{ url_for('clients.list_clients') }}" class="btn btn-secondary">Back to Clients</a>
</div>
{% endblock %}
